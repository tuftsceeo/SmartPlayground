<!DOCTYPE html>
<!--
Smart Playground Control - Main HTML Entry Point

This is the primary HTML file for the Smart Playground Control web application.
It serves as the entry point that integrates PyScript (Python in browser) with
vanilla JavaScript to create a mobile-first web app for controlling playground modules.

Key Features:
- PyScript integration for Python backend execution in browser
- Mobile-optimized viewport with touch-friendly interactions
- Progressive Web App (PWA) capabilities via manifest
- Designed with Tailwind CSS framework
- Web Bluetooth API support for ESP32 communication

Architecture:
- PyScript backend (main.py) handles BLE/Serial communication
- JavaScript frontend (main.js) manages UI and state
- Functional component pattern with reactive state management
- Event-driven Python-JavaScript communication via adapters

Browser Requirements:
- Chrome/Edge with Web Bluetooth API support
- HTTPS or localhost for Bluetooth access
- Modern JavaScript ES6+ module support

-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-content">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Smart Playground Control</title>
    <link rel="manifest" href="manifest.json">
    
    <!-- PyScript -->
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css">
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- JavaScript API Adapters (load BEFORE PyScript) -->
    <!-- These handle browser API operations natively to avoid Pyodide async issues -->
    <script type="module">
        // Import and expose adapters to window for Python access
        import { SerialAdapter } from './js/adapters/serialAdapter.js?v=3.0';
        import { BluetoothAdapter } from './js/adapters/bluetoothAdapter.js?v=3.0';
        
        window.serialAdapter = SerialAdapter;
        window.bluetoothAdapter = BluetoothAdapter;
        
        console.log('âœ… JavaScript adapters detected [v3.0 - Serial Debug Logging]');
    </script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            height: 100vh;
            height: 100dvh; /* Dynamic viewport height */
            overflow: hidden;
            background-color: #545c60;
        }
        html {
            height: 100%;
        }
        #root {
            height: calc(100vh - 27px);
            height: calc(100dvh - 27px - env(safe-area-inset-bottom)); /* Account for system navigation */
            display: flex;
            flex-direction: column;
        }
        #footer-spacer {
            height: 27px;
            background-color: #292929;
            flex-shrink: 0;
            /* This spacer matches the hosting service overlay */
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }
        
        /* Force scrollable content to encourage address bar hiding */
        .scrollable-content {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        /* Mobile-first touch optimizations */
        
        /* Remove hover states and add touch-friendly alternatives */
        button {
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
            transition: all 0.1s ease;
        }
        
        button:active {
            transform: scale(0.95);
        }
        
        /* Touch-friendly range sliders */
        input[type="range"] {
            height: 8px;
            -webkit-appearance: none;
            background: #e5e7eb;
            border-radius: 4px;
            cursor: pointer;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            width: 20px;
            height: 20px;
            -webkit-appearance: none;
            background: #374151;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.1s ease;
        }
        
        input[type="range"]::-webkit-slider-thumb:active {
            transform: scale(1.1);
            background: #1f2937;
        }
        
        /* Firefox range slider */
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #374151;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            transition: all 0.1s ease;
        }
        
        input[type="range"]::-moz-range-thumb:active {
            transform: scale(1.1);
            background: #1f2937;
        }
        
        /* Touch feedback for interactive elements */
        .touchable {
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.1s ease;
        }
        
        .touchable:active {
            transform: scale(0.98);
        }
        
        /* Remove hover states from cards and replace with active states */
        .device-card {
            transition: background-color 0.1s ease;
        }
        
        .device-card:active {
            background-color: #f9fafb;
        }
        
        .message-bubble {
            transition: background-color 0.1s ease;
        }
        
        .message-bubble:active {
            background-color: #d1d5db;
        }
        
        /* Fade-in animation for overlays */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .animate-fade-in {
            animation: fadeIn 0.2s ease-out;
        }
        
        /* Modal backdrop and panel animations */
        .modal-backdrop {
            transition: opacity 300ms ease;
        }
        
        .modal-backdrop.show {
            opacity: 1 !important;
        }
        
        .modal-panel {
            transition: transform 300ms ease-out;
        }
        
        .modal-panel.show {
            transform: translateY(0) !important;
        }
    </style>
</head>
<body>
    <!-- Python Backend with cache-busting -->
    <!-- Version: v3.1 - Fixed proxy destruction error -->
    <script type="py" src="main.py?v=3.1" config="pyscript.toml"></script>
    
    <!-- App Root Container -->
    <div id="root"></div>
    
    <!-- Footer Spacer -->
    <div id="footer-spacer"></div>
    
    <!-- Main Application - ES6 Module -->
    <script type="module" src="js/main.js?v=3.0"></script>
    
    <!-- Simple mobile detection for basic optimizations -->
    <script>
        // Simple mobile detection
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
                   (navigator.maxTouchPoints && navigator.maxTouchPoints > 1);
        }
        
        // Basic mobile optimizations
        if (isMobileDevice()) {
            // Prevent zoom on double tap
            document.addEventListener('touchstart', function(event) {
                if (event.touches.length > 1) {
                    event.preventDefault();
                }
            });
            
            // Prevent zoom on double tap
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function(event) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
        }
    </script>
    
</body>
</html>